# MBTI Assistant - å®Œæ•´é¡¹ç›®æ–‡æ¡£

> **TrueSelfMBTI.com** - ç”¨æœ€æ‡‚ä½ çš„æ–¹å¼ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°äº†è§£è‡ªå·±ï¼Œæˆä¸ºæ›´å¥½çš„è‡ªå·±

ä¸€ä¸ª AI é©±åŠ¨çš„ MBTI æ€§æ ¼æµ‹è¯„åº”ç”¨ï¼Œé€šè¿‡è‡ªç„¶å¯¹è¯è€Œéé€‰æ‹©é¢˜æ¥æ·±å…¥ç†è§£ç”¨æˆ·æ€§æ ¼ã€‚

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#2-æŠ€æœ¯æ ˆ)
3. [ç³»ç»Ÿæ¶æ„](#3-ç³»ç»Ÿæ¶æ„)
4. [åç«¯è¯¦è§£](#4-åç«¯è¯¦è§£)
5. [å‰ç«¯è¯¦è§£](#5-å‰ç«¯è¯¦è§£)
6. [æ ¸å¿ƒåŠŸèƒ½](#6-æ ¸å¿ƒåŠŸèƒ½)
7. [API æ¥å£æ–‡æ¡£](#7-api-æ¥å£æ–‡æ¡£)
8. [æ•°æ®æ¨¡å‹](#8-æ•°æ®æ¨¡å‹)
9. [AI æœåŠ¡è¯¦è§£](#9-ai-æœåŠ¡è¯¦è§£)
10. [éƒ¨ç½²ä¸è¿è¡Œ](#10-éƒ¨ç½²ä¸è¿è¡Œ)
11. [é…ç½®è¯´æ˜](#11-é…ç½®è¯´æ˜)
12. [å¼€å‘æŒ‡å—](#12-å¼€å‘æŒ‡å—)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

MBTI Assistant æ˜¯ä¸€æ¬¾åˆ›æ–°çš„ AI æ€§æ ¼æµ‹è¯„äº§å“ï¼Œæ‘’å¼ƒäº†ä¼ ç»Ÿ MBTI æµ‹è¯•çš„æ¯ç‡¥é€‰æ‹©é¢˜å½¢å¼ï¼Œé‡‡ç”¨è‡ªç„¶å¯¹è¯çš„æ–¹å¼è¿›è¡Œæ€§æ ¼è¯„ä¼°ã€‚åŸºäºè£æ ¼å¿ƒç†å­¦ç†è®ºï¼Œé€šè¿‡ Google Gemini AI è¿›è¡Œæ·±åº¦å¯¹è¯åˆ†æï¼Œå¸®åŠ©ç”¨æˆ·å‘ç°è‡ªå·±çš„çœŸå®æ€§æ ¼ç±»å‹ã€‚

### 1.2 æ ¸å¿ƒç‰¹è‰²

| ç‰¹æ€§ | æè¿° |
|------|------|
| ğŸ—£ï¸ **è‡ªç„¶å¯¹è¯** | åƒå’Œæœ‹å‹èŠå¤©ä¸€æ ·ï¼Œç”¨å¼€æ”¾å¼é—®é¢˜å¼•å¯¼ç”¨æˆ·è¡¨è¾¾çœŸå®è‡ªæˆ‘ |
| ğŸ§  **è£æ ¼ç†è®º** | åŸºäºå¡å°”Â·è£æ ¼åŸå‹å¿ƒç†å­¦ï¼Œæä¾›æœ‰å­¦æœ¯æ”¯æ’‘çš„åˆ†æ |
| âš¡ **å¤šæ·±åº¦æ¨¡å¼** | æ”¯æŒå¿«é€Ÿ(5é¢˜)ã€æ ‡å‡†(15é¢˜)ã€æ·±åº¦(30é¢˜)ä¸‰ç§æ¨¡å¼ |
| ğŸ“Š **è®¤çŸ¥åŠŸèƒ½åˆ†æ** | æ·±å…¥åˆ†æ 8 å¤§è®¤çŸ¥åŠŸèƒ½æ ˆï¼Œæ­ç¤ºæ€ç»´è¿ä½œçš„åº•å±‚é€»è¾‘ |
| ğŸ¨ **ä¸“å±ç”»åƒ** | AI ç”Ÿæˆä¸“å±äºç”¨æˆ·çš„ Pop Mart é£æ ¼äººæ ¼è§†è§‰è‚–åƒ |
| ğŸ’¬ **AI è§£ç­”** | æµ‹è¯•åä¸ AI å®æ—¶å¯¹è¯ï¼Œè§£ç­”å…³äºç»“æœçš„ä»»ä½•ç–‘é—® |
| ğŸ“ˆ **æ¸è¿›å¼æµ‹è¯•** | æ”¯æŒä»å¿«é€Ÿæ¨¡å¼æ— ç¼å‡çº§åˆ°æ›´æ·±å±‚æ¬¡çš„åˆ†æ |

### 1.3 MBTI ç±»å‹ä½“ç³»

é¡¹ç›®æ”¯æŒå®Œæ•´çš„ 16 ç§ MBTI äººæ ¼ç±»å‹ï¼Œåˆ†ä¸º 4 ä¸ªæ°”è´¨ç¾¤ä½“ï¼š

| ç¾¤ä½“ | é¢œè‰² | ç±»å‹ | ç‰¹å¾ |
|------|------|------|------|
| ğŸŸ£ **åˆ†æå®¶ (NT)** | `#88619a` | INTJ, INTP, ENTJ, ENTP | æˆ˜ç•¥æ€§æ€ç»´ï¼Œè¿½æ±‚çŸ¥è¯†å’Œèƒ½åŠ› |
| ğŸŸ¢ **å¤–äº¤å®¶ (NF)** | `#33a474` | INFJ, INFP, ENFJ, ENFP | æœ‰åŒç†å¿ƒçš„ç†æƒ³ä¸»ä¹‰è€… |
| ğŸ”µ **å®ˆå«è€… (SJ)** | `#4298b4` | ISTJ, ISFJ, ESTJ, ESFJ | å¯é çš„å®ˆæŠ¤è€…ï¼Œé‡è§†è´£ä»»å’Œä¼ ç»Ÿ |
| ğŸŸ¡ **æ¢ç´¢è€… (SP)** | `#e2a03f` | ISTP, ISFP, ESTP, ESFP | è‡ªå‘çš„åˆ›é€ è€…ï¼Œè¿½æ±‚è‡ªç”±å’Œä½“éªŒ |

---

## 2. æŠ€æœ¯æ ˆ

### 2.1 åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **FastAPI** | 0.115.6 | Web æ¡†æ¶ |
| **Python** | 3.11+ | ç¼–ç¨‹è¯­è¨€ |
| **SQLAlchemy** | 2.0.36 | å¼‚æ­¥ ORM |
| **SQLite + aiosqlite** | 0.20.0 | æ•°æ®åº“ (MVP) |
| **Pydantic** | 2.10.4 | æ•°æ®éªŒè¯ |
| **Google Generative AI** | 0.8.3 | Gemini AI æœåŠ¡ |
| **Uvicorn** | 0.34.0 | ASGI æœåŠ¡å™¨ |

### 2.2 å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Next.js** | 15.1.3 | React æ¡†æ¶ (App Router) |
| **React** | 19.0.0 | UI åº“ |
| **TypeScript** | 5.7.2 | ç±»å‹å®‰å…¨ |
| **Tailwind CSS** | 3.4.17 | æ ·å¼æ¡†æ¶ |
| **Framer Motion** | 11.15.0 | åŠ¨ç”»åº“ |
| **Zustand** | 5.0.2 | çŠ¶æ€ç®¡ç† |
| **Lucide React** | 0.469.0 | å›¾æ ‡åº“ |

### 2.3 AI æ¨¡å‹

| æ¨¡å‹ | ç”¨é€” |
|------|------|
| **gemini-3-flash-preview** | å¯¹è¯é—®ç­” (å¿«é€Ÿå“åº”) |
| **gemini-3-pro-preview** | æœ€ç»ˆåˆ†ææŠ¥å‘Š (æ·±åº¦åˆ†æ) |
| **gemini-3-pro-image-preview** | ä¸ªæ€§åŒ–å¤´åƒç”Ÿæˆ |

---

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Frontend (Next.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Components â”‚  â”‚    Hooks     â”‚  â”‚       Context          â”‚  â”‚
â”‚  â”‚  - Chat UI  â”‚  â”‚ useChatSessionâ”‚ â”‚ - ThemeContext        â”‚  â”‚
â”‚  â”‚  - Result   â”‚  â”‚ useQASession â”‚  â”‚ - ToastContext        â”‚  â”‚
â”‚  â”‚  - Depth    â”‚  â”‚ useAnalytics â”‚  â”‚                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      API Client (lib/api.ts)               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTP/REST
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Backend (FastAPI)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                        Routers                               â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚   chat.py        â”‚    â”‚        analytics.py            â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /start         â”‚    â”‚ - /profile                     â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /message       â”‚    â”‚ - /event                       â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /finish        â”‚    â”‚ - /feedback                    â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /upgrade       â”‚    â”‚ - /stats                       â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /qa            â”‚    â”‚ - /extract-insights            â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - /image         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                       Services                               â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚  â”‚   ai_service    â”‚ â”‚ image_generator â”‚ â”‚ insight_extractorâ”‚â”‚
â”‚  â”‚  â”‚ - generate_resp â”‚ â”‚ - Pop Mart styleâ”‚ â”‚ - Demographics â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - final_report  â”‚ â”‚ - Avatar gen    â”‚ â”‚ - Behavior     â”‚ â”‚â”‚
â”‚  â”‚  â”‚ - upgrade_quest â”‚ â”‚                 â”‚ â”‚                â”‚ â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                          â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                     Database (SQLite)                        â”‚â”‚
â”‚  â”‚  Sessions â”‚ Messages â”‚ Analyses â”‚ UserProfiles â”‚ Events     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Google Gemini AI                             â”‚
â”‚           Flash (Chat) â”‚ Pro (Analysis) â”‚ Image                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç›®å½•ç»“æ„

```
MBTI/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ config.py            # ç¯å¢ƒé…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dependencies.py      # ä¾èµ–æ³¨å…¥ (é™æµç­‰)
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py      # SQLAlchemy æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py       # Pydantic æ¨¡å¼å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.py     # åˆ†æç›¸å…³æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ analytics_schemas.py  # åˆ†æ API æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py          # èŠå¤© API è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ analytics.py     # åˆ†æ API è·¯ç”±
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ ai_service.py    # AI æœåŠ¡ (Gemini)
â”‚   â”‚       â”œâ”€â”€ image_generator.py    # å›¾ç‰‡ç”ŸæˆæœåŠ¡
â”‚   â”‚       â””â”€â”€ user_insight_extractor.py  # ç”¨æˆ·æ´å¯Ÿæå–
â”‚   â”œâ”€â”€ mbti_assistant.db        # SQLite æ•°æ®åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”‚   â””â”€â”€ venv/                    # è™šæ‹Ÿç¯å¢ƒ
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx       # æ ¹å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # ä¸»é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ providers.tsx    # Context Providers
â”‚   â”‚   â”‚   â””â”€â”€ globals.css      # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ chat/            # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatBubble.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ChatInput.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DynamicBackground.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ StatusBar.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/              # é€šç”¨ UI ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AIQAView.tsx     # AI é—®ç­”è§†å›¾
â”‚   â”‚   â”‚   â”œâ”€â”€ DepthSelector.tsx    # æ·±åº¦é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FeedbackButton.tsx   # åé¦ˆæŒ‰é’®
â”‚   â”‚   â”‚   â””â”€â”€ ResultView.tsx   # ç»“æœå±•ç¤ºè§†å›¾
â”‚   â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”‚   â”œâ”€â”€ ThemeContext.tsx     # ä¸»é¢˜ä¸Šä¸‹æ–‡
â”‚   â”‚   â”‚   â””â”€â”€ ToastContext.tsx     # Toast é€šçŸ¥ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ useChatSession.ts    # èŠå¤©ä¼šè¯ Hook
â”‚   â”‚   â”‚   â”œâ”€â”€ useQASession.ts      # Q&A ä¼šè¯ Hook
â”‚   â”‚   â”‚   â””â”€â”€ useAnalytics.ts      # åˆ†æåŸ‹ç‚¹ Hook
â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts           # API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ analytics.ts     # åˆ†æå·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ utils.ts         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â””â”€â”€ chat.ts          # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ mbti.ts          # MBTI ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tailwind.config.ts
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â””â”€â”€ next.config.ts
â”‚
â”œâ”€â”€ README.md
â””â”€â”€ start-tunnel.sh              # Cloudflare éš§é“å¯åŠ¨è„šæœ¬
```

---

## 4. åç«¯è¯¦è§£

### 4.1 åº”ç”¨å…¥å£ (main.py)

FastAPI åº”ç”¨é…ç½®äº†ä»¥ä¸‹ç‰¹æ€§ï¼š

```python
# ç”Ÿå‘½å‘¨æœŸç®¡ç†
@asynccontextmanager
async def lifespan(app: FastAPI):
    # å¯åŠ¨æ—¶åˆå§‹åŒ–æ•°æ®åº“
    await init_db()
    yield
    # å…³é—­æ—¶æ¸…ç†èµ„æº

# CORS é…ç½® - å…è®¸æ‰€æœ‰æ¥æº (å¼€å‘/éš§é“è®¿é—®)
app.add_middleware(CORSMiddleware, allow_origins=["*"], ...)

# å…¨å±€å¼‚å¸¸å¤„ç†
@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    ...

# è·¯ç”±æ³¨å†Œ
app.include_router(chat.router, prefix="/api/chat")
app.include_router(analytics.router, prefix="/api/analytics")
```

### 4.2 é…ç½®ç®¡ç† (config.py)

ä½¿ç”¨ Pydantic Settings ç®¡ç†ç¯å¢ƒå˜é‡ï¼š

```python
class Settings(BaseSettings):
    # åº”ç”¨é…ç½®
    APP_NAME: str = "MBTI Assistant MVP"
    APP_VERSION: str = "0.1.0"
    DEBUG: bool = False
    
    # API å¯†é’¥
    GEMINI_API_KEY: str = ""
    NANO_BANANA_KEY: str = ""  # é¢„ç•™
    
    # æ•°æ®åº“
    DATABASE_URL: str = "sqlite+aiosqlite:///./mbti_assistant.db"
    
    # AI æ¨¡å‹é…ç½® (æ··åˆæ¨¡å‹ç­–ç•¥)
    GEMINI_MODEL_CHAT: str = "gemini-3-flash-preview"      # å¯¹è¯
    GEMINI_MODEL_ANALYSIS: str = "gemini-3-pro-preview"    # åˆ†æ
    GEMINI_IMAGE_MODEL: str = "gemini-3-pro-image-preview" # å›¾åƒ
```

### 4.3 ä¾èµ–æ³¨å…¥ (dependencies.py)

æä¾›é™æµå’Œè¯·æ±‚å¤„ç†ä¾èµ–ï¼š

```python
# å†…å­˜é™æµå™¨ (MVP ç‰ˆæœ¬)
class InMemoryRateLimiter:
    def check_session_limit(self, ip: str) -> tuple[bool, Optional[str]]:
        ...
    def check_message_limit(self, ip: str) -> tuple[bool, Optional[str]]:
        ...

# FastAPI ä¾èµ–
async def verify_session_rate_limit(request: Request) -> str:
    """éªŒè¯ä¼šè¯åˆ›å»ºé¢‘ç‡é™åˆ¶"""
    ...

async def verify_message_rate_limit(request: Request) -> str:
    """éªŒè¯æ¶ˆæ¯å‘é€é¢‘ç‡é™åˆ¶"""
    ...

def get_client_ip(request: Request) -> str:
    """è·å–çœŸå®å®¢æˆ·ç«¯ IP (æ”¯æŒä»£ç†å¤´)"""
    ...
```

---

## 5. å‰ç«¯è¯¦è§£

### 5.1 åº”ç”¨ç»“æ„

å‰ç«¯é‡‡ç”¨ Next.js 15 App Router æ¶æ„ï¼š

```
app/
â”œâ”€â”€ layout.tsx      # æ ¹å¸ƒå±€ (å­—ä½“ã€Providers)
â”œâ”€â”€ page.tsx        # ä¸»é¡µé¢ (SPA å•é¡µåº”ç”¨)
â”œâ”€â”€ providers.tsx   # Context Providers é›†åˆ
â””â”€â”€ globals.css     # å…¨å±€æ ·å¼ (Tailwind)
```

### 5.2 çŠ¶æ€ç®¡ç† (useChatSession)

æ ¸å¿ƒ Hook ç®¡ç†æ•´ä¸ªèŠå¤©ä¼šè¯çŠ¶æ€ï¼š

```typescript
interface ChatSessionState {
  // ä¼šè¯çŠ¶æ€
  sessionId: string | null;
  depth: AnalysisDepth | null;
  isStarted: boolean;
  isRestoring: boolean;
  
  // æ¶ˆæ¯
  messages: ChatMessage[];
  
  // UI çŠ¶æ€
  input: string;
  isLoading: boolean;
  isTyping: boolean;
  
  // è¿›åº¦
  progress: number;
  currentPrediction: string;
  confidenceScore: number;
  currentRound: number;
  maxRounds: number;
  
  // å®ŒæˆçŠ¶æ€
  isFinished: boolean;
  isAtMaxRounds: boolean;
  resultData: ResultData | null;
  
  // å›¾ç‰‡ç”Ÿæˆ
  isGeneratingImage: boolean;
  generatedImageUrl: string | null;
}

interface ChatSessionActions {
  startSession: (depth: AnalysisDepth) => Promise<void>;
  sendMessage: (content?: string) => Promise<void>;
  finishSession: () => Promise<void>;
  upgradeToStandard: () => Promise<void>;
  upgradeToDeep: () => Promise<void>;
  generateImage: () => Promise<void>;
  reset: () => void;
}
```

### 5.3 ä¸»é¢˜ç³»ç»Ÿ (ThemeContext)

åŠ¨æ€ä¸»é¢˜æ ¹æ® MBTI ç±»å‹å˜åŒ–ï¼š

```typescript
type MBTITheme = "analyst" | "diplomat" | "sentinel" | "explorer" | "neutral";

const THEME_COLORS: Record<MBTITheme, ThemeColors> = {
  analyst: {
    primary: "#88619a",
    primaryRgb: "136, 97, 154",
    gradient: "from-analyst/20 via-analyst/10 to-transparent",
  },
  // ... å…¶ä»–ä¸»é¢˜
};

// æ ¹æ®é¢„æµ‹ç»“æœè‡ªåŠ¨åˆ‡æ¢ä¸»é¢˜
setThemeFromPrediction("INTJ")  // -> analyst ä¸»é¢˜
setThemeFromPrediction("ENFP")  // -> diplomat ä¸»é¢˜
```

### 5.4 ç»„ä»¶ä½“ç³»

#### æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ |
|------|------|
| `DepthSelector` | æµ‹è¯•æ·±åº¦é€‰æ‹©ç•Œé¢ |
| `ChatBubble` | å¯¹è¯æ°”æ³¡ (ç”¨æˆ·/AI) |
| `ChatInput` | æ¶ˆæ¯è¾“å…¥æ¡† |
| `StatusBar` | è¿›åº¦æ¡å’Œé¢„æµ‹æ˜¾ç¤º |
| `DynamicBackground` | åŠ¨æ€æ¸å˜èƒŒæ™¯ |
| `ResultView` | ç»“æœå±•ç¤ºé¡µ |
| `AIQAView` | AI é—®ç­”ç•Œé¢ |
| `FeedbackButton` | ç”¨æˆ·åé¦ˆæŒ‰é’® |

---

## 6. æ ¸å¿ƒåŠŸèƒ½

### 6.1 ä¸‰çº§æ·±åº¦åˆ†ææ¨¡å¼

| æ¨¡å¼ | å¯¹è¯è½®æ•° | è¾“å‡ºç»“æœ | ç‰¹è‰²åŠŸèƒ½ |
|------|----------|----------|----------|
| **å¿«é€Ÿæ¨¡å¼** | 5 é¢˜ | æ°”è´¨é¢œè‰² (NT/NF/SJ/SP) | åŸºç¡€æ€§æ ¼æŠ¥å‘Š |
| **æ ‡å‡†æ¨¡å¼** | 15 é¢˜ | å®Œæ•´ 4 å­—æ¯ MBTI ç±»å‹ | ä¸“å±ç”»åƒ + AI è§£ç­” + è¯¦ç»†æŠ¥å‘Š |
| **æ·±åº¦æ¨¡å¼** | 30 é¢˜ | MBTI + è®¤çŸ¥åŠŸèƒ½æ ˆ + å‘å±•é˜¶æ®µ | ä¸“ä¸šå¿ƒç†æŠ¥å‘Š + è£æ ¼åˆ†æ |

### 6.2 æ¸è¿›å¼å‡çº§

ç”¨æˆ·å¯ä»¥åœ¨å®Œæˆä½çº§åˆ«æµ‹è¯•åï¼Œæ— ç¼å‡çº§åˆ°æ›´æ·±å±‚æ¬¡ï¼š

```
å¿«é€Ÿæ¨¡å¼ (5é¢˜) â†’ æ ‡å‡†æ¨¡å¼ (å†ç­”10é¢˜) â†’ æ·±åº¦æ¨¡å¼ (å†ç­”15é¢˜)
       â†“                    â†“                     â†“
    æ°”è´¨é¢œè‰²            MBTI ç±»å‹           è®¤çŸ¥åŠŸèƒ½åˆ†æ
```

å‡çº§æ—¶ä¿ç•™æ‰€æœ‰å¯¹è¯å†å²ï¼ŒAI ä¼šåŸºäºå·²æœ‰å¯¹è¯ç»§ç»­æ·±å…¥æ¢ç´¢ã€‚

### 6.3 AI å¯¹è¯ç­–ç•¥

#### å¼€æ”¾å¼æé—®

AI è¢«æ˜ç¡®æŒ‡ç¤º**ç¦æ­¢**é—®äºŒé€‰ä¸€çš„é—®é¢˜ï¼Œå§‹ç»ˆä½¿ç”¨å¼€æ”¾å¼é—®é¢˜ï¼š

```
âŒ "ä½ æ˜¯å–œæ¬¢è®¡åˆ’è¿˜æ˜¯éšæ€§ï¼Ÿ"
âŒ "ä½ æ›´å…³æ³¨é€»è¾‘è¿˜æ˜¯æƒ…æ„Ÿï¼Ÿ"

âœ… "è¯´è¯´æœ€è¿‘è®©ä½ è§‰å¾—ç‰¹åˆ«æœ‰æˆå°±æ„Ÿçš„ä¸€ä»¶äº‹..."
âœ… "é‡åˆ°è¿™ç§æƒ…å†µä½ ä¸€èˆ¬ä¼šæ€ä¹ˆåšï¼Ÿ"
```

#### å¯¹è¯è½®æ¬¡æ§åˆ¶

AI å¿…é¡»å®ŒæˆæŒ‡å®šè½®æ•°çš„å¯¹è¯ï¼Œä¸å¾—æå‰ç»“æŸï¼š

```python
# ä» ai_service.py
if is_final_round:
    parsed_response.is_finished = True  # åªåœ¨æœ€åä¸€è½®è®¾ç½®
else:
    parsed_response.is_finished = False  # å¼ºåˆ¶ç»§ç»­å¯¹è¯
```

### 6.4 è®¤çŸ¥åŠŸèƒ½åˆ†æ (æ·±åº¦æ¨¡å¼)

æ·±åº¦æ¨¡å¼åˆ†æç”¨æˆ·çš„ 8 å¤§è®¤çŸ¥åŠŸèƒ½ï¼š

| åŠŸèƒ½ | ç±»å‹ | æè¿° |
|------|------|------|
| **Ni** | å†…å€¾ç›´è§‰ | æ·±å±‚æ´å¯Ÿï¼Œé¢„è§è¶‹åŠ¿ |
| **Ne** | å¤–å€¾ç›´è§‰ | å‘æ•£æ€ç»´ï¼Œçœ‹åˆ°å¯èƒ½æ€§ |
| **Si** | å†…å€¾æ„Ÿè§‰ | è¯¦ç»†è®°å¿†ï¼Œä¾èµ–ç»éªŒ |
| **Se** | å¤–å€¾æ„Ÿè§‰ | æ´»åœ¨å½“ä¸‹ï¼Œæ„Ÿå®˜æ•é” |
| **Ti** | å†…å€¾æ€ç»´ | å†…éƒ¨é€»è¾‘ï¼Œåˆ†æåŸç† |
| **Te** | å¤–å€¾æ€ç»´ | ç»„ç»‡æ•ˆç‡ï¼Œç›®æ ‡å¯¼å‘ |
| **Fi** | å†…å€¾æƒ…æ„Ÿ | ä¸ªäººä»·å€¼è§‚ï¼Œè¿½æ±‚çœŸå® |
| **Fe** | å¤–å€¾æƒ…æ„Ÿ | äººé™…å’Œè°ï¼Œç†è§£ä»–äºº |

### 6.5 Pop Mart é£æ ¼å¤´åƒç”Ÿæˆ

åŸºäºå¯¹è¯å†…å®¹ç”Ÿæˆä¸ªæ€§åŒ–å¤´åƒï¼š

```python
# ä¸¤æ­¥ç”Ÿæˆè¿‡ç¨‹
async def generate_personality_avatar(self, ...):
    # æ­¥éª¤1: åˆ†æç”¨æˆ·æ¡£æ¡ˆ
    profile = await self._analyze_user_profile(
        mbti_type, type_name, confidence, conversation_history
    )
    
    # æ­¥éª¤2: ç”Ÿæˆ Pop Mart é£æ ¼å›¾åƒ
    prompt = self._build_pop_mart_prompt(mbti_type, profile)
    response = await self._image_model.generate_content_async(prompt)
```

ç”Ÿæˆçš„å›¾åƒåŒ…å«ï¼š
- å¯çˆ± 3D Chibi è§’è‰²
- æ ¹æ®ç”¨æˆ·ç‰¹å¾å®šåˆ¶çš„æœè£…å’Œå§¿åŠ¿
- ä»£è¡¨æ€§æ ¼çš„æµ®åŠ¨å…ƒç´ 
- MBTI ç±»å‹æ ‡è¯†åº•åº§
- å“ç‰Œæ°´å°

### 6.6 AI Q&A é—®ç­”ç³»ç»Ÿ

å®Œæˆæµ‹è¯•åï¼Œç”¨æˆ·å¯ä»¥ä¸ AI å¯¹è¯æ·±å…¥äº†è§£ç»“æœï¼š

```typescript
const presetQuestions = [
  { label: "æ€§æ ¼ä¼˜åŠ¿", question: "è¯¦ç»†åˆ†æä¸€ä¸‹æˆ‘è¿™ä¸ªç±»å‹çš„æ ¸å¿ƒä¼˜åŠ¿..." },
  { label: "èŒä¸šå»ºè®®", question: "ä»€ä¹ˆæ ·çš„èŒä¸šæœ€é€‚åˆæˆ‘ï¼Ÿ" },
  { label: "äººé™…å…³ç³»", question: "æˆ‘åœ¨äººé™…å…³ç³»ä¸­æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" },
  { label: "æˆé•¿å»ºè®®", question: "æˆ‘åº”è¯¥å¦‚ä½•å‘å±•è‡ªå·±çš„å¼±é¡¹ï¼Ÿ" },
];
```

---

## 7. API æ¥å£æ–‡æ¡£

### 7.1 èŠå¤© API (`/api/chat`)

#### å¼€å§‹ä¼šè¯

```http
POST /api/chat/start
Content-Type: application/json

{
  "depth": "standard",    // shallow | standard | deep
  "language": "zh-CN",    // è¯­è¨€ä»£ç 
  "user_name": "å¯é€‰"     // ç”¨æˆ·æ˜µç§°
}
```

**å“åº”ï¼š**

```json
{
  "session_id": "uuid-string",
  "depth": "standard",
  "language": "zh-CN",
  "greeting": "ä½ å¥½å‘€ï¼æ¬¢è¿æ¥æ¢ç´¢ä½ çš„MBTIæ€§æ ¼ç±»å‹ï½...",
  "rate_limit": {
    "sessions_today": 1,
    "sessions_limit": 999999,
    "messages_today": 0,
    "messages_limit": 999999
  }
}
```

#### å‘é€æ¶ˆæ¯

```http
POST /api/chat/message
Content-Type: application/json

{
  "session_id": "uuid-string",
  "content": "ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯"
}
```

**å“åº”ï¼š**

```json
{
  "message_id": 123,
  "reply_text": "AI çš„å›å¤å†…å®¹...",
  "is_finished": false,
  "is_at_max_rounds": false,
  "current_prediction": "INTJ",
  "confidence_score": 75,
  "progress": 60,
  "current_round": 9,
  "max_rounds": 15,
  "cognitive_stack": null,
  "development_level": null
}
```

#### å®Œæˆä¼šè¯

```http
POST /api/chat/finish
Content-Type: application/json

{
  "session_id": "uuid-string"
}
```

**å“åº”ï¼š**

```json
{
  "session_id": "uuid-string",
  "mbti_type": "INTJ",
  "type_name": "å»ºç­‘å¸ˆ",
  "group": "analyst",
  "confidence_score": 85,
  "analysis_report": "è¯¦ç»†çš„åˆ†ææŠ¥å‘Šæ–‡æœ¬...",
  "total_rounds": 15,
  "cognitive_stack": ["Ni", "Te", "Fi", "Se"],
  "development_level": "Medium"
}
```

#### å‡çº§æ¨¡å¼

```http
POST /api/chat/upgrade
Content-Type: application/json

{
  "session_id": "uuid-string"
}
```

**å“åº”ï¼š**

```json
{
  "session_id": "uuid-string",
  "new_depth": "standard",
  "remaining_rounds": 10,
  "message": "å·²å‡çº§åˆ°æ ‡å‡†æ¨¡å¼ï¼è¿˜éœ€å®Œæˆçº¦ 10 é“é¢˜...",
  "ai_question": "å¤ªå¥½äº†ï¼Œä½ çš„æ°”è´¨å·²ç»å¾ˆæ¸…æ™°äº†ï¼æ¥ä¸‹æ¥..."
}
```

#### AI é—®ç­”

```http
POST /api/chat/qa
Content-Type: application/json

{
  "session_id": "uuid-string",
  "question": "ä»€ä¹ˆèŒä¸šé€‚åˆæˆ‘ï¼Ÿ",
  "history": []  // å¯é€‰ï¼šä¹‹å‰çš„é—®ç­”å†å²
}
```

**å“åº”ï¼š**

```json
{
  "answer": "æ ¹æ®ä½ çš„ INTJ æ€§æ ¼ç±»å‹...",
  "mbti_type": "INTJ",
  "type_name": "å»ºç­‘å¸ˆ"
}
```

#### ç”Ÿæˆå¤´åƒ

```http
POST /api/chat/image?session_id=uuid-string
```

**å“åº”ï¼š**

```json
{
  "status": "success",
  "message": "Your personalized INTJ Pop Mart avatar has been generated!",
  "image_url": "data:image/png;base64,..."
}
```

#### è·å–èŠå¤©å†å²

```http
GET /api/chat/history/{session_id}
```

#### è·å–ä¼šè¯çŠ¶æ€

```http
GET /api/chat/status/{session_id}
```

### 7.2 åˆ†æ API (`/api/analytics`)

#### ç”¨æˆ·æ¡£æ¡ˆ

```http
POST /api/analytics/profile
GET /api/analytics/profile/{anonymous_id}
```

#### äº‹ä»¶è¿½è¸ª

```http
POST /api/analytics/event
POST /api/analytics/events/batch
```

#### åé¦ˆ

```http
POST /api/analytics/feedback
```

#### ç»Ÿè®¡ä¿¡æ¯

```http
GET /api/analytics/stats?days=30
GET /api/analytics/events/export
GET /api/analytics/feedback/export
GET /api/analytics/insights/export
```

### 7.3 å¥åº·æ£€æŸ¥

```http
GET /                # æ ¹è·¯ç”± - API ä¿¡æ¯
GET /health          # å¥åº·çŠ¶æ€
GET /rate-limit      # å½“å‰é™æµçŠ¶æ€
```

---

## 8. æ•°æ®æ¨¡å‹

### 8.1 æ ¸å¿ƒæ•°æ®æ¨¡å‹

#### Session (ä¼šè¯)

```python
class Session(Base):
    __tablename__ = "sessions"
    
    id: str                 # UUID ä¸»é”®
    depth: str              # shallow/standard/deep
    language: str           # zh-CN, en
    user_name: str | None   # å¯é€‰ç”¨æˆ·å
    
    # å®¢æˆ·ç«¯ä¿¡æ¯
    client_ip: str | None
    user_agent: str | None
    
    # ä¼šè¯çŠ¶æ€
    is_active: bool         # æ˜¯å¦æ´»è·ƒ
    is_complete: bool       # æ˜¯å¦å®Œæˆ
    current_round: int      # å½“å‰è½®æ•°
    
    # é¢„æµ‹ç»“æœ
    current_prediction: str | None  # MBTI ç±»å‹
    confidence_score: int | None    # ç½®ä¿¡åº¦
    progress: int | None            # è¿›åº¦ç™¾åˆ†æ¯”
    
    # æ·±åº¦æ¨¡å¼å­—æ®µ
    cognitive_stack: str | None     # JSON: ["Ni", "Te", "Fi", "Se"]
    development_level: str | None   # Low/Medium/High
    
    # æ—¶é—´æˆ³
    created_at: datetime
    updated_at: datetime
    
    # å…³ç³»
    messages: list[Message]
    analysis: Analysis | None
```

#### Message (æ¶ˆæ¯)

```python
class Message(Base):
    __tablename__ = "messages"
    
    id: int                 # è‡ªå¢ä¸»é”®
    session_id: str         # å…³è”ä¼šè¯
    role: str               # user/model/system
    content: str            # æ¶ˆæ¯å†…å®¹
    
    # AI å“åº”å…ƒæ•°æ® (JSON)
    ai_metadata: dict | None  # {is_finished, current_prediction, ...}
    
    created_at: datetime
```

#### Analysis (åˆ†æç»“æœ)

```python
class Analysis(Base):
    __tablename__ = "analyses"
    
    id: str
    session_id: str
    
    # æœ€ç»ˆç»“æœ
    mbti_type: str          # INTJ, ENFP, etc.
    group: str              # analyst/diplomat/sentinel/explorer
    
    # ç»´åº¦å¾—åˆ† (0-100, 50 ä¸ºä¸­æ€§)
    ei_score: float         # E < 50, I > 50
    sn_score: float         # S < 50, N > 50
    tf_score: float         # T < 50, F > 50
    jp_score: float         # J < 50, P > 50
    
    # æ·±åº¦æ¨¡å¼ç»“æœ
    cognitive_stack: str | None      # JSON æ•°ç»„
    development_level: str | None
    
    # æ–‡æœ¬ç»“æœ
    summary: str
    strengths: str          # JSON æ•°ç»„
    growth_areas: str       # JSON æ•°ç»„
```

### 8.2 åˆ†ææ•°æ®æ¨¡å‹

#### UserProfile (ç”¨æˆ·æ¡£æ¡ˆ)

```python
class UserProfile(Base):
    __tablename__ = "user_profiles"
    
    anonymous_id: str       # åŒ¿åè¿½è¸ª ID
    
    # å¯é€‰äººå£ç»Ÿè®¡æ•°æ®
    age_range: str | None
    gender: str | None
    occupation: str | None
    country: str | None
    
    # æ¥æºè¿½è¸ª
    referral_source: str | None
    utm_source: str | None
    utm_medium: str | None
    utm_campaign: str | None
    
    # è®¾å¤‡ä¿¡æ¯
    device_type: str | None
    browser: str | None
```

#### UserEvent (äº‹ä»¶)

```python
class UserEvent(Base):
    __tablename__ = "user_events"
    
    anonymous_id: str
    session_id: str | None
    
    event_name: str         # page_view, session_start, etc.
    event_category: str     # navigation, chat, result, etc.
    event_data: dict | None # çµæ´»çš„äº‹ä»¶æ•°æ®
    
    page_path: str | None
    timestamp: datetime
    duration_seconds: float | None
```

#### UserInsight (æ´å¯Ÿ)

```python
class UserInsight(Base):
    __tablename__ = "user_insights"
    
    session_id: str
    mbti_result: str
    
    # æ¨æ–­çš„äººå£ç»Ÿè®¡
    estimated_age_range: str | None
    estimated_gender: str | None
    life_stage: str | None
    career_field: str | None
    
    # æ²Ÿé€šé£æ ¼
    communication_style: str | None
    language_complexity: str | None
    engagement_quality: str | None
    
    # åˆ†æå…ƒæ•°æ®
    key_topics_discussed: str | None  # JSON æ•°ç»„
    confidence_score: float
```

---

## 9. AI æœåŠ¡è¯¦è§£

### 9.1 æ··åˆæ¨¡å‹ç­–ç•¥

ç³»ç»Ÿé‡‡ç”¨æ··åˆæ¨¡å‹ç­–ç•¥ä¼˜åŒ–æˆæœ¬å’Œè´¨é‡ï¼š

| ä»»åŠ¡ | æ¨¡å‹ | åŸå›  |
|------|------|------|
| å¯¹è¯é—®ç­” | Flash | å¿«é€Ÿå“åº”ï¼Œä½æˆæœ¬ |
| æœ€ç»ˆæŠ¥å‘Š | Pro | æ·±åº¦åˆ†æï¼Œé«˜è´¨é‡ |
| å›¾åƒç”Ÿæˆ | Pro Image | ä¸“ä¸šå›¾åƒç”Ÿæˆ |
| ç”¨æˆ·æ´å¯Ÿ | Flash | å¿«é€Ÿåˆ†æï¼Œåå°ä»»åŠ¡ |

### 9.2 æç¤ºè¯å·¥ç¨‹

#### ç³»ç»Ÿæç¤ºè¯ç»“æ„

```python
SYSTEM_PROMPTS = {
    AnalysisDepth.SHALLOW: """
    ä½ æ˜¯ä¸€ä½æ¸©æš–ã€æœ‰æ´å¯ŸåŠ›çš„æ€§æ ¼æ¢ç´¢é¡¾é—®...
    
    ## ä½ çš„ä»»åŠ¡
    é€šè¿‡æœ€å¤š5è½®è‡ªç„¶å¯¹è¯ï¼Œè¯†åˆ«ç”¨æˆ·å±äºå“ªç§æ°”è´¨é¢œè‰²
    
    ## å››ç§æ°”è´¨é¢œè‰²
    - ç´«è‰² (NT - åˆ†æå®¶): ...
    - ç»¿è‰² (NF - å¤–äº¤å®¶): ...
    - ...
    
    ## å¯¹è¯é£æ ¼ - åƒæœ‹å‹èŠå¤©ä¸€æ ·
    - è¡¨ç°å¾—çœŸè¯šã€å¥½å¥‡
    - ç”¨è½»æ¾è‡ªç„¶çš„è¯­æ°”
    
    ## æé—®ç­–ç•¥ - åªç”¨å¼€æ”¾å¼é—®é¢˜
    **ç»å¯¹ç¦æ­¢**é—®"Aè¿˜æ˜¯Bï¼Ÿ"è¿™ç§äºŒé€‰ä¸€çš„é—®é¢˜ï¼
    
    ## é‡è¦è§„åˆ™
    1. ç»å¯¹ä¸è¦æå‰ç»“æŸå¯¹è¯
    2. æ¯ä¸€è½®éƒ½å¿…é¡»é—®æ–°é—®é¢˜
    """,
    
    AnalysisDepth.STANDARD: """...""",
    AnalysisDepth.DEEP: """...""",
}
```

#### è¾“å‡ºæ ¼å¼

AI è¢«è¦æ±‚è¿”å›ç»“æ„åŒ– JSONï¼š

```json
{
  "reply_text": "ç”¨ä¸­æ–‡å›å¤ï¼Œæ¸©æš–è‡ªç„¶çš„è¯­æ°”",
  "is_finished": false,
  "wants_to_finish": false,
  "current_prediction": "INTJ",
  "confidence_score": 65,
  "progress": 40,
  "cognitive_stack": ["Ni", "Te", "Fi", "Se"],
  "development_level": "Medium"
}
```

### 9.3 Q&A æœåŠ¡

ç‹¬ç«‹çš„ Q&A æœåŠ¡å¤„ç†æµ‹è¯•åçš„é—®ç­”ï¼š

```python
class QAService:
    """ä½¿ç”¨ Flash æ¨¡å‹è¿›è¡Œå¿«é€Ÿé—®ç­”"""
    
    async def generate_response(
        self,
        user_question: str,
        mbti_type: str,
        type_name: str,
        group: str,
        confidence_score: int,
        cognitive_stack: list[str] | None,
        development_level: str | None,
        depth: str,
        language: str,
        history: list[dict] | None,
    ) -> str:
        ...
```

---

## 10. éƒ¨ç½²ä¸è¿è¡Œ

### 10.1 ç¯å¢ƒè¦æ±‚

- Python 3.11+
- Node.js 20+
- pnpm (æ¨è) æˆ– npm

### 10.2 åç«¯å¯åŠ¨

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd backend

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ·»åŠ  GEMINI_API_KEY

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uvicorn app.main:app --reload --port 8000
```

### 10.3 å‰ç«¯å¯åŠ¨

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd frontend

# 2. å®‰è£…ä¾èµ–
pnpm install  # æˆ– npm install

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev  # æˆ– npm run dev
```

### 10.4 è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ |
|------|------|
| å‰ç«¯åº”ç”¨ | http://localhost:3000 |
| åç«¯ API | http://localhost:8000 |
| API æ–‡æ¡£ | http://localhost:8000/docs |
| ReDoc | http://localhost:8000/redoc |

### 10.5 Cloudflare éš§é“ (å¯é€‰)

é¡¹ç›®åŒ…å« `start-tunnel.sh` ç”¨äºåˆ›å»º Cloudflare éš§é“å®ç°å¤–ç½‘è®¿é—®ã€‚

---

## 11. é…ç½®è¯´æ˜

### 11.1 åç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `backend/.env` æ–‡ä»¶ï¼š

```env
# åº”ç”¨é…ç½®
DEBUG=true

# AI æœåŠ¡
GEMINI_API_KEY=your-gemini-api-key

# æ•°æ®åº“ (å¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ SQLite)
DATABASE_URL=sqlite+aiosqlite:///./mbti_assistant.db

# CORS (å¯é€‰ï¼Œé»˜è®¤å…è®¸æ‰€æœ‰)
CORS_ORIGINS=["http://localhost:3000"]
```

### 11.2 å‰ç«¯ç¯å¢ƒå˜é‡

åˆ›å»º `frontend/.env.local` æ–‡ä»¶ï¼š

```env
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### 11.3 æ¨¡å‹é…ç½®

åœ¨ `config.py` ä¸­å¯è°ƒæ•´ AI æ¨¡å‹ï¼š

```python
# å¯¹è¯æ¨¡å‹ (å¿«é€Ÿå“åº”)
GEMINI_MODEL_CHAT: str = "gemini-3-flash-preview"

# åˆ†ææ¨¡å‹ (æ·±åº¦åˆ†æ)
GEMINI_MODEL_ANALYSIS: str = "gemini-3-pro-preview"

# å›¾åƒæ¨¡å‹
GEMINI_IMAGE_MODEL: str = "gemini-3-pro-image-preview"
```

### 11.4 æ·±åº¦æ¨¡å¼é…ç½®

```python
DEPTH_CONFIGS: dict[AnalysisDepth, DepthConfig] = {
    AnalysisDepth.SHALLOW: DepthConfig(
        min_rounds=0, max_rounds=5, target_confidence=100
    ),
    AnalysisDepth.STANDARD: DepthConfig(
        min_rounds=0, max_rounds=15, target_confidence=100
    ),
    AnalysisDepth.DEEP: DepthConfig(
        min_rounds=0, max_rounds=30, target_confidence=100
    ),
}
```

---

## 12. å¼€å‘æŒ‡å—

### 12.1 ä»£ç è§„èŒƒ

- **è¯­è¨€**ï¼šæ‰€æœ‰ä»£ç æ³¨é‡Šå’Œå˜é‡åä½¿ç”¨è‹±æ–‡
- **æ ¼å¼**ï¼šä½¿ç”¨é¡¹ç›®é…ç½®çš„ linter (ESLint, Black)
- **ç±»å‹**ï¼šTypeScript ä¸¥æ ¼æ¨¡å¼ï¼ŒPython ç±»å‹æ³¨è§£

### 12.2 æ·»åŠ æ–°çš„ MBTI ç±»å‹æ”¯æŒ

1. æ›´æ–° `backend/app/routers/chat.py` ä¸­çš„ `MBTI_TYPE_NAMES_ZH` å’Œ `MBTI_GROUPS`
2. æ›´æ–° `frontend/src/types/mbti.ts` ä¸­çš„ç±»å‹å®šä¹‰
3. æ›´æ–° `frontend/src/context/ThemeContext.tsx` ä¸­çš„ä¸»é¢˜æ˜ å°„

### 12.3 æ·»åŠ æ–°çš„åˆ†ææ·±åº¦

1. åœ¨ `backend/app/services/ai_service.py` ä¸­ï¼š
   - æ·»åŠ æ–°çš„ `AnalysisDepth` æšä¸¾å€¼
   - æ·»åŠ æ–°çš„ `SYSTEM_PROMPTS` æ¡ç›®
   - æ›´æ–° `DEPTH_CONFIGS`

2. åœ¨å‰ç«¯æ›´æ–°ï¼š
   - `DepthSelector` ç»„ä»¶
   - `useChatSession` Hook ä¸­çš„ç›¸å…³é€»è¾‘

### 12.4 æµ‹è¯•

```bash
# åç«¯æµ‹è¯•
cd backend
pytest

# å‰ç«¯ç±»å‹æ£€æŸ¥
cd frontend
pnpm type-check
```

### 12.5 ç”Ÿäº§éƒ¨ç½²å»ºè®®

- [ ] å°† SQLite è¿ç§»åˆ° PostgreSQL
- [ ] ä½¿ç”¨ Redis æ›¿æ¢å†…å­˜é™æµå™¨
- [ ] é…ç½®é€‚å½“çš„ CORS ç­–ç•¥
- [ ] æ·»åŠ è®¤è¯æœºåˆ¶
- [ ] é…ç½® CDN åŠ é€Ÿé™æ€èµ„æº
- [ ] æ·»åŠ ç›‘æ§å’Œæ—¥å¿—æ”¶é›†

---

## é™„å½•

### A. API é”™è¯¯ç 

| çŠ¶æ€ç  | å«ä¹‰ |
|--------|------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 404 | èµ„æºæœªæ‰¾åˆ° |
| 429 | è¯·æ±‚é¢‘ç‡é™åˆ¶ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 503 | AI æœåŠ¡ä¸å¯ç”¨ |

### B. äº‹ä»¶ç±»å‹

```python
class EventNames:
    PAGE_VIEW = "page_view"
    SESSION_START = "session_start"
    SESSION_COMPLETE = "session_complete"
    SESSION_ABANDON = "session_abandon"
    SESSION_UPGRADE = "session_upgrade"
    MESSAGE_SENT = "message_sent"
    RESULT_VIEW = "result_view"
    RESULT_SHARE = "result_share"
    IMAGE_GENERATE = "image_generate"
    QA_START = "qa_start"
    QA_QUESTION = "qa_question"
    FEEDBACK_SUBMIT = "feedback_submit"
```

### C. è®¸å¯è¯

MIT License

---

**Built with â¤ï¸ for personality discovery**

*æœ€åæ›´æ–°ï¼š2026å¹´1æœˆ*
